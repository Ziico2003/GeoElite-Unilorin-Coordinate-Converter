<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoElite Unilorin Coordinate Converter</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

    <style>
        /* --- GLOBAL RESET --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f1f8e9; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }

        /* --- HEADER & HAMBURGER --- */
        header { 
            background: linear-gradient(90deg, #66bb6a, #43a047); 
            color: white; 
            padding: 15px 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            z-index: 1000;
            display: flex;
            align-items: center;
        }
        
        .hamburger { font-size: 28px; cursor: pointer; margin-right: 20px; }
        header h1 { margin: 0; font-size: 1.5rem; }

        /* --- SIDE MENU --- */
        .side-menu {
            height: 100%; width: 0; position: fixed; z-index: 2000; top: 0; left: 0;
            background-color: #1b5e20; overflow-x: hidden; transition: 0.3s; padding-top: 60px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
        }
        .side-menu a {
            padding: 15px 20px; text-decoration: none; font-size: 1.1rem; color: #e8f5e9;
            display: block; transition: 0.2s; border-bottom: 1px solid #2e7d32;
        }
        .side-menu a:hover { background-color: #2e7d32; color: white; }
        .side-menu .close-btn { position: absolute; top: 10px; right: 20px; font-size: 36px; border-bottom: none; }

        /* --- LAYOUT --- */
        .main-container { display: flex; flex: 1; padding: 20px; gap: 20px; overflow: hidden; position: relative; }

        /* --- LEFT PANEL (CARDS) --- */
        .converter-panel { width: 450px; overflow-y: auto; display: flex; flex-direction: column; z-index: 20; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 4px solid #66bb6a; }
        .card h3 { margin-top: 0; font-size: 1.1rem; color: #2e7d32; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 15px; }

        /* Hide all but the first card by default */
        #card-minna-to-wgs, #card-utm-converter, #card-about { display: none; }

        /* --- INPUTS & BUTTONS --- */
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-group { flex: 1; }
        label { display: block; font-size: 0.8rem; color: #555; margin-bottom: 4px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; background-color: #66bb6a; color: white; border: none; padding: 12px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 5px; transition: 0.2s; }
        button:hover { background-color: #43a047; }
        .locate-btn { background-color: #ff9800; width: auto; font-size: 0.8rem; padding: 8px 15px; margin-bottom: 15px; }
        .locate-btn:hover { background-color: #e68a00; }

        /* --- RESULTS & COPY ICON --- */
        .result-box { margin-top: 15px; padding: 15px; background-color: #e8f5e9; border-left: 4px solid #66bb6a; font-size: 0.95rem; display: none; position: relative; border-radius: 0 6px 6px 0; }
        .copy-btn { 
            position: absolute; top: 10px; right: 10px; width: auto; background: none; color: #2e7d32; 
            border: 1px solid #66bb6a; padding: 4px 8px; font-size: 0.8rem; border-radius: 4px; 
            cursor: pointer; margin: 0; font-weight: normal;
        }
        .copy-btn:hover { background: #c8e6c9; }

        /* --- ABOUT SECTION STYLING --- */
        .about-text { font-size: 0.95rem; color: #444; line-height: 1.6; }
        .about-text ul { padding-left: 20px; margin-top: 5px; }
        .about-text li { margin-bottom: 8px; }

        /* --- RIGHT PANEL (MAP) --- */
        .map-panel { flex: 1; background: #e0e0e0; border-radius: 12px; overflow: hidden; position: relative; min-height: 400px; z-index: 10; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        #map { width: 100%; height: 100%; z-index: 1; }

        /* --- FOOTER --- */
        footer { background-color: #1b5e20; color: white; text-align: center; padding: 10px; font-size: 0.8rem; }

        /* --- MOBILE RESPONSIVENESS --- */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; height: auto; overflow: auto; }
            .converter-panel { width: 100%; }
            .map-panel { height: 400px; flex: none; }
        }
    </style>
</head>
<body>

    <header>
        <span class="hamburger" onclick="openMenu()">&#9776;</span>
        <h1>GeoElite Unilorin Coordinate Converter</h1>
    </header>

    <div id="mySideMenu" class="side-menu">
        <a href="javascript:void(0)" class="close-btn" onclick="closeMenu()">&times;</a>
        <a href="#" onclick="switchCard('card-wgs-to-minna')">WGS84 &rarr; Minna / UTM</a>
        <a href="#" onclick="switchCard('card-minna-to-wgs')">Minna (Geog) &rarr; WGS84 / UTM</a>
        <a href="#" onclick="switchCard('card-utm-converter')">Minna (UTM) &rarr; WGS84</a>
        <a href="#" onclick="switchCard('card-about')">About This Project</a>
    </div>

    <div class="main-container">
        
        <div class="converter-panel">

            <div id="card-wgs-to-minna" class="card">
                <h3>WGS84 &rarr; Minna / UTM</h3>
                <button onclick="locateMe()" class="locate-btn">üìç Use My GPS Location</button>
                <div class="input-row">
                    <div class="input-group">
                        <label>Latitude (Dec or DMS)</label>
                        <input type="text" id="wgs_lat" placeholder="e.g. 8 30 15 or 8.5">
                    </div>
                    <div class="input-group">
                        <label>Longitude (Dec or DMS)</label>
                        <input type="text" id="wgs_lon" placeholder="e.g. 4 30 15 or 4.5">
                    </div>
                </div>
                <div class="input-row">
                    <button onclick="convert('wgs_to_minna')">To Minna</button>
                    <button onclick="convert('wgs_to_utm')" style="margin-left: 5px;">To UTM</button>
                </div>
                <div id="res_wgs" class="result-box"></div>
            </div>

            <div id="card-minna-to-wgs" class="card">
                <h3>Minna (Geographic) &rarr; WGS84 / UTM</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Latitude (Minna)</label>
                        <input type="text" id="minna_lat" placeholder="e.g. 8 30 15">
                    </div>
                    <div class="input-group">
                        <label>Longitude (Minna)</label>
                        <input type="text" id="minna_lon" placeholder="e.g. 4 30 15">
                    </div>
                </div>
                <div class="input-row">
                    <button onclick="convert('minna_to_wgs')">To WGS84</button>
                    <button onclick="convert('minna_to_utm')" style="margin-left: 5px;">To Minna UTM</button>
                </div>
                <div id="res_minna" class="result-box"></div>
            </div>

            <div id="card-utm-converter" class="card">
                <h3>Minna (UTM) &rarr; WGS84 / WGS UTM</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>Easting (m)</label>
                        <input type="text" id="utm_e" placeholder="e.g. 500000">
                    </div>
                    <div class="input-group">
                        <label>Northing (m)</label>
                        <input type="text" id="utm_n" placeholder="e.g. 900000">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Zone (Required)</label>
                        <select id="utm_z">
                            <option value="" selected disabled>-- Select Zone --</option>
                            <option value="31">Zone 31</option>
                            <option value="32">Zone 32</option>
                            <option value="33">Zone 33</option>
                        </select>
                    </div>
                </div>
                <button onclick="convert('utm_to_wgs')">Convert</button>
                <div id="res_utm" class="result-box"></div>
            </div>

            <div id="card-about" class="card">
                <h3>About GeoElite Unilorin Coordinate Converter</h3>
                <div class="about-text">
                    <p>This application is a specialized geoinformatics tool developed within the <strong>Department of Surveying and Geoinformatics, University of Ilorin</strong>.</p>
                    <p><strong>Core Capabilities:</strong></p>
                    <ul>
                        <li>WGS84 (Geographic) to Minna Datum transformations.</li>
                        <li>Minna Datum to WGS84 transformations.</li>
                        <li>Projected UTM Zone (31, 32, 33) conversions to geographic coordinates.</li>
                    </ul>
                    <p>It leverages a Python-based backend for complex geodetic math and Leaflet.js for interactive spatial mapping, providing high-precision coordinate transformations tailored for the Nigerian Geodetic Network.</p>
                </div>
            </div>

        </div>

        <div class="map-panel">
            <div id="map"></div>
        </div>
    </div>

    <footer>&copy; Department of Surveying and Geoinformatics, University of Ilorin</footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // --- MENU LOGIC ---
        function openMenu() { document.getElementById("mySideMenu").style.width = "280px"; }
        function closeMenu() { document.getElementById("mySideMenu").style.width = "0"; }

        function switchCard(cardId) {
            // Hide all cards
            document.getElementById('card-wgs-to-minna').style.display = 'none';
            document.getElementById('card-minna-to-wgs').style.display = 'none';
            document.getElementById('card-utm-converter').style.display = 'none';
            document.getElementById('card-about').style.display = 'none';
            
            // Show the selected card
            document.getElementById(cardId).style.display = 'block';
            
            // Close the menu
            closeMenu();
        }

        // --- MAP INITIALIZATION ---
        var map = L.map('map', { zoomControl: false, center: [8.482, 4.675], zoom: 13 });
        var marker;
        var accuracyCircle;

        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '¬© OpenStreetMap' }).addTo(map);
        var sat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { maxZoom: 19, attribution: 'Tiles ¬© Esri' });
        L.control.layers({ "Street Map": osm, "Satellite": sat }).addTo(map);

        L.control.zoom({ position: 'topright' }).addTo(map);
        L.control.scale({ position: 'bottomright', metric: true, imperial: false }).addTo(map);

        // --- COPY TO CLIPBOARD LOGIC ---
        function copyText(elementId, btnElement) {
            var textToCopy = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(textToCopy).then(() => {
                var originalText = btnElement.innerHTML;
                btnElement.innerHTML = "‚úÖ Copied";
                setTimeout(() => { btnElement.innerHTML = originalText; }, 2000);
            }).catch(err => {
                console.error("Failed to copy: ", err);
            });
        }

        // --- UI HELPER ---
        function showResult(boxId, htmlContent) {
            var el = document.getElementById(boxId);
            el.innerHTML = `
                <button class="copy-btn" onclick="copyText('${boxId}_data', this)">üìã Copy</button>
                <div id="${boxId}_data" style="margin-top: 5px;">${htmlContent}</div>
            `;
            el.style.display = 'block';
        }

        function updateMap(lat, lon, popupText) {
            lat = parseFloat(lat); lon = parseFloat(lon);
            if (isNaN(lat) || isNaN(lon)) return;
            if (marker) map.removeLayer(marker);
            marker = L.marker([lat, lon]).addTo(map).bindPopup(popupText).openPopup();
            map.flyTo([lat, lon], 17, { animate: true, duration: 1.5 });
        }

        // --- GPS LOGIC ---
        function locateMe() {
            if (!navigator.geolocation) return alert("Geolocation not supported.");
            navigator.geolocation.getCurrentPosition((pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                const acc = pos.coords.accuracy;

                document.getElementById('wgs_lat').value = lat.toFixed(7);
                document.getElementById('wgs_lon').value = lon.toFixed(7);

                updateMap(lat, lon, `<b>Your GPS Location</b><br>Accuracy: ¬±${Math.round(acc)}m`);

                if (accuracyCircle) map.removeLayer(accuracyCircle);
                accuracyCircle = L.circle([lat, lon], { color: '#136AEC', fillColor: '#136AEC', fillOpacity: 0.15, radius: acc }).addTo(map);
                map.fitBounds(accuracyCircle.getBounds());
            }, (err) => { alert("GPS Error: " + err.message); }, { enableHighAccuracy: true });
        }

        // --- API CONVERSION LOGIC ---
        function convert(type) {
            var data = { type: type };

            if (type === 'wgs_to_minna' || type === 'wgs_to_utm') {
                data.lat = document.getElementById('wgs_lat').value;
                data.lon = document.getElementById('wgs_lon').value;
            } else if (type === 'minna_to_wgs' || type === 'minna_to_utm') {
                data.lat = document.getElementById('minna_lat').value;
                data.lon = document.getElementById('minna_lon').value;
            } else if (type === 'utm_to_wgs') {
                data.easting = document.getElementById('utm_e').value;
                data.northing = document.getElementById('utm_n').value;
                data.zone = document.getElementById('utm_z').value;
                if (!data.zone) return alert("‚ö†Ô∏è Please select a UTM Zone!");
            }

            fetch('/convert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(res => {
                if (!res.success) return alert("Error: " + res.error);

                if (type === 'wgs_to_minna') {
                    showResult('res_wgs', `<b>Minna Datum:</b><br>Lat: ${res.lat_dms}<br>Lon: ${res.lon_dms}`);
                    updateMap(data.lat, data.lon, "Input WGS84");
                } else if (type === 'wgs_to_utm') {
                    showResult('res_wgs', `<b>Zone ${res.zone} (Minna):</b><br>E: ${res.easting}m<br>N: ${res.northing}m`);
                    updateMap(data.lat, data.lon, "Input WGS84");
                } else if (type === 'minna_to_wgs') {
                    showResult('res_minna', `<b>WGS84 Result:</b><br>Lat: ${res.lat_dms}<br>Lon: ${res.lon_dms}`);
                    updateMap(res.lat, res.lon, "Converted WGS84");
                } else if (type === 'minna_to_utm') {
                    showResult('res_minna', `<b>Minna UTM:</b><br>Zone ${res.zone}<br>E: ${res.easting}<br>N: ${res.northing}`);
                    updateMap(res.map_lat, res.map_lon, "Input Location (Minna Datum)"); 
                } else if (type === 'utm_to_wgs') {
                    showResult('res_utm', `
                        <b>WGS84 (Geographic):</b><br>Lat: ${res.lat_dms}<br>Lon: ${res.lon_dms}<br><br>
                        <b>WGS84 (UTM Zone ${res.wgs_utm_zone}):</b><br>E: ${res.wgs_utm_e}m<br>N: ${res.wgs_utm_n}m
                    `);
                    updateMap(res.lat, res.lon, "Converted WGS84");
                }
            })
            .catch(err => console.error(err));
        }
    </script>
</body>
</html>
